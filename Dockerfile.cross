FROM docker.io/library/alpine:3.21.0@sha256:21dc6063fd678b478f57c0e13f47560d0ea4eeba26dfc947b2a4f81f686b9f45 AS builder
RUN apk add --no-cache \
    icu-libs \
    sqlite-static \
    yaml-static \
    yaml-dev \
    libxml2-static \
    zlib-static \
    openssl-libs-static \
    openssl-dev \
    musl-dev \
    xz-static \
    gcc \
    pcre2-dev \
    gc-dev \
    libevent-dev

WORKDIR /invidious

ARG INVIDIOUS
COPY ${INVIDIOUS} ./
ARG BUILDLOG
COPY ${BUILDLOG} ./

RUN $(tail -n1 buildlog)